# DiaryQuest - 機能ドキュメント

## 機能概要

DiaryQuestは、日々の振り返りをRPGスタイルのクエストに変換するゲーム化ジャーナリング体験として設計されています。以下は、実装済みおよび計画中のすべての機能の包括的な内訳です。

## コア機能

### 1. 認証システム

#### Firebase認証統合
- **メール/パスワードログイン**：安全なユーザー認証
- **匿名ログイン**：アカウント作成なしでアプリを使用するオプション
- **セッション管理**：自動セッション永続化
- **エラーハンドリング**：認証失敗時の包括的エラーメッセージ

```dart
// 機能の場所: lib/features/auth/
├── login_screen.dart          # メインログインインターフェース
└── navigator_selection_screen.dart  # 初回ナビゲーター選択
```

**ユーザーフロー**:
1. アプリ起動 → 既存セッションを確認
2. セッションなし → ログイン画面表示
3. 初回ログイン → ナビゲーター選択
4. 以降のログイン → ホーム画面へ直接移動

### 2. 音声入力システム

#### 音声認識統合
- **リアルタイム録音**：録音中の視覚的フィードバック
- **ライブ文字起こし**：話しながらテキストが更新される
- **手動テキスト入力**：音声入力の代替手段
- **権限処理**：適切なマイク権限リクエスト
- **音声処理**：バックグラウンド音声処理

```dart
// 機能の場所: lib/core/services/speech_service.dart
```

**主な機能**:
- 録音開始/停止ボタンと視覚的インジケーター
- 録音中のパルスアニメーション
- 文字数制限（500文字）
- 録音後のテキスト編集
- 基本機能のオフライン対応

### 3. AI分析エンジン

#### OpenAI GPT-4o統合
- **インテリジェント分析**：日記エントリーを構造化された成長機会に変換
- **15パラメーターシステム**：MECEベースの成長パラメーターマッピング
- **リフレーミング**：ネガティブな経験をポジティブな成長に変換
- **ナビゲーター性格**：5種類のAIペルソナが独自のフィードバックを提供

**分析出力**:
1. **要約**：構造化された日報（100-200文字）
2. **リフレーム内容**：経験のポジティブな再解釈（100-200文字）
3. **経験値**：15パラメーターそれぞれ0-20 XP
4. **ナビゲーターコメント**：性格特有のフィードバック（50-100文字）

```dart
// 機能の場所: lib/core/services/openai_service.dart
```

**プロンプトエンジニアリング**:
- コンテキストを意識したシステムプロンプト
- ナビゲーター固有の性格パラメーター
- 構造化されたJSON出力形式
- API失敗時のエラーハンドリング

### 4. 成長パラメーターシステム

#### MECEフレームワーク実装
- **5カテゴリー**：思考、実行、対人、自制、挑戦
- **15パラメーター**：カテゴリーごとに3つのパラメーター（固有のアイコンとカラー付き）
- **視覚的な進行**：カラー分けされたパラメーター追跡
- **レベル計算**：XPベースのレベルアップシステム

**パラメーター内訳**:

| カテゴリー | パラメーター | アイコン | 色 | 成長メッセージ |
|----------|------------|-------|---------|-----------------|
| **思考（Tactics）** | 分析力、創造力、専門性 | 分析、電球、学校 | 青 | 「論理的思考が冴え渡った」 |
| **実行（Execution）** | スピード、品質、仕組み化 | 速度、認定、設定 | 緑 | 「疾風の如く駆け抜けた」 |
| **対人（Social）** | 交渉力、共感力、言語化 | 握手、お気に入り、記録 | オレンジ | 「心の絆が深まった」 |
| **自制（Mastery）** | レジリエンス、規律、メタ認知 | シールド、リピート、心理学 | 紫 | 「不屈の精神が宿った」 |
| **挑戦（Frontier）** | リスクテイク、学習棄却、ビジョン | トレンド、更新、可視化 | 赤 | 「勇者の心が燃えた」 |

```dart
// 機能の場所: lib/core/constants/parameters.dart
```

### 5. ナビゲーターシステム

#### 5つの相棒性格
各ナビゲーターが独自の性格ベースのフィードバックを提供：

1. **軍師（Strategist）**
   - **性格**：分析的、データ駆動型
   - **説明**：冷静沈着な参謀。データに基づく分析で成長を導く。
   - **アイコン**：軍師アイコン
   - **色**：青

2. **アニキ（Big Brother）**
   - **性格**：情熱的、励まし上手
   - **説明**：熱血漢の兄貴分。情熱的に背中を押してくれる。
   - **アイコン**：アニキ
   - **色**：赤

3. **精霊（Spirit）**
   - **性格**：優しい、癒し系
   - **説明**：森の精霊。優しく穏やかに心を癒やしてくれる。
   - **アイコン**：精霊/エルフ
   - **色**：緑

4. **騎士（Knight）**
   - **性格**：誠実、原則重視
   - **説明**：誠実な騎士。正義感を持って共に挑戦する。
   - **アイコン**：騎士
   - **色**：シルバー

5. **猫妖精（Cat Fairy）**
   - **性格**：遊び心、ユーモラス
   - **説明**：気まぐれな猫の妖精。ユーモアで緊張をほぐす。
   - **アイコン**：猫妖精
   - **色**：ピンク

```dart
// 機能の場所: lib/models/user.dart (NavigatorType enum)
```

### 6. クエスト作成とレポート

#### クエストレポートインターフェース
- **デュアル入力**：音声とテキスト入力オプション
- **ライブプレビュー**：リアルタイム文字起こし表示
- **分析アニメーション**：AI処理中のローディングインジケーター
- **結果表示**：視覚的な要素を含む構造化されたクエスト結果

**クエスト作成フロー**:
1. ユーザーがマイクボタンをタップ
2. 音声を録音またはテキストを入力
3. 分析用に送信
4. AIが処理して結果を生成
5. XP報酬と共に結果を表示
6. クエストをユーザー履歴に保存

```dart
// 機能の場所: lib/features/quest/
├── quest_report_screen.dart        # メインクエストインターフェース
└── widgets/
    ├── quest_loading_animation.dart  # ローディングアニメーション
    └── quest_result_card.dart        # 結果表示ウィジェット
```

### 7. ユーザー進行システム

#### RPGライク進行
- **ベースレベル**：5段階のベース（テント → 小屋 → 家 → 館 → 城）
- **総経験値**：すべてのパラメーターにわたる累積XP
- **連続日数**：ボーナス付き日次ストリーク追跡
- **フォーカスボーナス**：連続アクティビティによる追加XP

**レベルしきい値**:
- レベル1: 0-200 XP（テント）
- レベル2: 200-500 XP（小屋）
- レベル3: 500-1000 XP（家）
- レベル4: 1000-2000 XP（館）
- レベル5: 2000+ XP（城）

**フォーカスボーナス構造**:
- 3日以上: 10 XPボーナス
- 7日以上: 20 XPボーナス
- 14日以上: 30 XPボーナス
- 21日以上: 40 XPボーナス
- 30日以上: 50 XPボーナス

```dart
// 機能の場所: lib/providers/user_provider.dart
```

### 8. ホーム画面ダッシュボード

#### メインインターフェースコンポーネント
1. **プレイヤーヘッダー**
   - 現在のレベルとベース名
   - 総経験値（ゴールド）
   - 現在のジョブタイトル
   - XP進行バー

2. **日記入力カード**
   - クエストレポートへのクイックアクセス
   - 最近のクエスト数
   - モチベーショナルメッセージ
   - クイック統計表示

3. **統計行**
   - 今日完了したクエスト
   - 現在のストリーク
   - フォーカスボーナスインジケーター

4. **スピリットバディメッセージ**
   - 日次モチベーショナルメッセージ
   - コンテキストを意識した励まし
   - ナビゲーター性格のインサイト

```dart
// 機能の場所: lib/features/home/
├── home_screen.dart              # メインダッシュボード
└── widgets/
    ├── player_header.dart       # レベル/XP表示
    ├── diary_input_card.dart    # クイッククエストアクセス
    ├── stats_row.dart           # 統計表示
    └── spirit_buddy_message.dart # モチベーショナルメッセージ
```

## 計画中の機能

### 1. ジョブとスキルシステム（フェーズ2）

#### キャラクター開発
- **ジョブ**：独自のメリットを持つ異なるキャリアパス
  - 戦士：戦闘関連パラメーターボーナス
  - 魔法使い：魔法関連パラメーターボーナス
  - 商人：取引関連パラメーターボーナス
  - 学者：知識関連パラメーターボーナス

- **スキル**：パラメーターベースの解放可能アビリティ
  - アクティブスキル：一時的ブーストまたは特別アビリティ
  - パッシブスキル：永続的なステータス改善
  - マスタースキル：高いパラメーターを必要とする高度なアビリティ

**実装計画**:
```dart
// 計画場所: lib/models/
├── job.dart              # ジョブ定義とメリット
└── skill.dart            # スキルシステムと要件
```

### 2. 週次レポートと分析

#### 高度な分析
- **週次サマリー**：7日間の成長概要
- **パラメータートレンド**：視覚的な成長チャート
- **実績追跡**：マイルストーン通知
- **インサイト**：AI生成の成長推奨事項

**機能**:
- パラメーター比較チャート
- 週次ベストパフォーマー特定
- 目標追跡と完了状況
- パーソナライズされた成長インサイト

```dart
// 計画場所: lib/features/weekly_report/
├── weekly_report_screen.dart      # メイン分析
└── widgets/
    ├── parameter_chart.dart      # 成長の可視化
    ├── milestone_card.dart       # 実績表示
    └── insight_widget.dart       # AI推奨事項
```

### 3. 実績システム

#### ゲーム化要素
- **バッジ**：マイルストーン用の解放可能実績
- **タイトル**：実績に基づく特別タイトル
- **リーダーボード**：オプションの競争要素
- **コレクション**：完了可能なアクティビティセット

**バッジカテゴリー**:
- ファーストステップ：初期アプリ使用
- 一貫性：日次ストリーク実績
- 多様性：パラメーター多様性
- 習熟：高パラメータースコア
- スペシャル：ユニークなマイルストーン実績

### 4. ソーシャル機能（フェーズ3）

#### コミュニティ構築
- **チームクエスト**：協力グループアクティビティ
- **フレンドシステム**：他ユーザーとの接続
- **共有可能クエスト**：オプションのソーシャルシェア
- **グループ分析**：チーム進行追跡

**プライバシーオプション**:
- プライベートモード（デフォルト）
- フレンドのみ共有
- 公開共有（オプトイン）
- 匿名参加

### 5. 高度なAI機能

#### 拡張インテリジェンス
- **長期メモリ**：セッション間でのコンテキスト対応AI
- **パーソナライズされたプロンプト**：カスタムAI性格開発
- **目標統合**：個人の目標に関するAI支援
- **進行予測**：将来の成長予測

**AI能力**:
- センチメント分析の改善
- パターン認識
- パーソナライズされた成長提案
- 危機検出とサポート

### 6. マルチプラットフォーム対応

#### クロスプラットフォーム利用可能
- **Androidアプリ**：ネイティブAndroid実装
- **Webコンパニオン**：ブラウザベースのコンパニオンアプリ
- **デスクトップアプリ**：Windows/macOSデスクトップ版
- **API統合**：サードパーティサービス接続

**同期**:
- クラウドベースのデータ同期
- オフライン対応
- プラットフォーム一貫性のある体験
- データバックアップと復元

## 技術機能

### 1. 状態管理

#### Riverpod実装
- **プロバイダー組織**：機能ベースの状態管理
- **リアクティブ更新**：状態変化時の自動UI更新
- **状態永続化**：リモートバックアップ付きローカル状態
- **エラーバウンダリー**：優雅なエラーハンドリング

**プロバイダー構造**:
```dart
// lib/providers/
├── auth_provider.dart         # 認証状態
├── user_provider.dart         # ユーザーデータと進行
├── quest_provider.dart        # クエスト管理
└── [feature]_provider.dart   # 機能固有状態
```

### 2. データ永続化

#### Firestore統合
- **リアルタイム更新**：ライブデータ同期
- **オフラインサポート**：競合解決付きローカルキャッシュ
- **データセキュリティ**：ユーザー分離データアクセス
- **パフォーマンス**：最適化されたクエリとインデックス

**コレクション**:
- `users`: ユーザープロフィールと設定
- `quests`: クエスト履歴と分析
- ユーザー固有データ用サブコレクション

### 3. UI/UXデザイン

#### ピクセルアートレトロゲームスタイル
- **カスタムタイポグラフィ**：Press Start 2P（ヘッダー）、VT323（本文）
- **カラーシステム**：カテゴリーベースのパラメーター色
- **アニメーション**：スムーズな遷移とマイクロインタラクション
- **アクセシビリティ**：高コントラストと読みやすいフォント

**デザイン原則**:
- 一貫した視覚言語
- 明確な情報階層
- 直感的なナビゲーションパターン
- デバイス間レスポンシブデザイン

### 4. パフォーマンス最適化

#### アプリパフォーマンス
- **遅延読み込み**：オンデマンド機能読み込み
- **画像キャッシュ**：最適化されたアセット読み込み
- **コード分割**：モジュラー機能コンパイル
- **メモリ管理**：効率的なリソースクリーンアップ

**最適化技術**:
- constウィジェットコンストラクタ
- 選択的状態更新
- デバウンス付き入力処理
- バックグラウンドタスク管理

### 5. テストフレームワーク

#### 包括的テスト
- **単体テスト**：ビジネスロジック検証
- **ウィジェットテスト**：UIインタラクションテスト
- **統合テスト**：エンドツーエンドユーザーフロー
- **パフォーマンステスト**：速度とリソース使用量

**テストカバレッジ**:
- 80%以上単体テストカバレッジ
- 重要UIインタラクションのテスト
- API統合テスト
- エラーシナリオテスト

## 機能実装ステータス

### ✅ MVP機能（現在）
- [x] ユーザー認証
- [x] 音声入力システム
- [x] GPT-4oによるAI分析
- [x] 15パラメーター成長追跡
- [x] ナビゲーター性格システム
- [x] クエスト作成と保存
- [x] ホーム画面ダッシュボード
- [x] レベル進行システム
- [x] 連続日数追跡
- [x] 基本UIコンポーネント

### 🔄 フェーズ2機能（2025年Q1）
- [ ] ジョブとスキルシステム
- [ ] 週次レポートと分析
- [ ] 実績バッジシステム
- [ ] 拡張AIインサイト
- [ ] Androidアプリリリース

### 📋 フェーズ3機能（2025年Q2）
- [ ] ソーシャル機能とチーム
- [ ] プレミアムサブスクリプションモデル
- [ ] 高度な分析
- [ ] Webコンパニオンアプリ
- [ ] API統合プラットフォーム

### 🚀 フェーズ4機能（2025年Q3）
- [ ] エンタープライズソリューション
- [ ] カスタムナビゲーター作成
- [ ] 高度なAI機能
- [ ] マルチプラットフォーム同期
- [ ] サードパーティ統合

## ユーザーフロー例

### 1. 新ユーザーオンボーディング
```
1. アプリダウンロード → 起動画面
2. ログイン/アカウント作成 → 認証画面
3. ナビゲーター選択 → 性格選択
4. ホームダッシュボード → 最初のクエストプロンプト
5. 最初のクエスト完了 → チュートリアル完了
6. 日次ルーチン → 習慣形成
```

### 2. 日次ジャーナリングルーチン
```
1. アプリを開く → ホーム画面
2. マイクボタンをタップ → クエストレポート
3. 日次振り返りを話す → 音声録音
4. 分析を送信 → AI処理
5. 結果を表示 → XP報酬
6. ホームに戻る → 更新された統計
```

### 3. 進行追跡
```
1. ダッシュボード表示 → 現在のレベル/XP
2. パラメーター確認 → 成長分野
3. 履歴確認 → 過去のクエスト
4. 実績表示 → マイルストーン
5. 目標設定 → 将来の目標
```

この包括的な機能セットにより、DiaryQuestは将来の開発に向けた明確な拡張パスを持つ完全なゲーム化ジャーナリングソリューションとして確立されています。
